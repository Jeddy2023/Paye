<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../stylesheet/style.css">
    <link rel="stylesheet" href="../stylesheet/main.css">
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>

    <style>
        .div1 {
            display: flex;
            margin-top: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <nav class="main-nav">
            <a href="#" class="logo"><span>P</span>aye</a>

            <ul class="menu">
                <li id="dasboard" class="active" data-target="#dashmain"><a><i class='bx bxs-grid-alt '></i>Dasboard</a>
                </li>
                <li id="deposit" data-target="#deposit-content"><a><i class='bx bx-bar-chart-alt'></i>Deposit</a></li>
                <li id="withdraw" data-target="#withdraw-content"><a><i class='bx bx-money-withdraw'></i>Withdraw</a>
                </li>
                <li id="transfer" data-target="#transfer-content"><a><i class='bx bx-transfer'></i>Transfer</a></li>
                <li id="logout"><a href="../pages/login.html"><i class='bx bx-power-off'></i>Logout</a> </li>
            </ul>

        </nav>

        <div class="main-content">
            <nav>
                <div class="profile">
                    <img src="../img/Humaaans - Space.png" alt="">
                    <div class="text">
                        <span>Hi</span>
                        <h4 id="user"></h4>
                    </div>
                </div>


                <div class="balance-notification">
                    <div class="balance">
                        <h3 class="balance" class="hide">******</h3>
                    </div>
                    <button type="button" id="showBalanceButton">Show Balance</button>
                </div>

            </nav>

            <div class="main">
                <div class="dashmain-container active tab__item" content id="dashmain">
                    <div class="box">
                        <i style="background-color: #F98D04;"><span>₦</span></i>
                        <div class="amount-balance">
                            <span>Avaliable Balance:</span>
                            <h1 class="balance" style="color: #F98D04;">₦0.000</h1>
                        </div>
                        <p>Balance</p>
                    </div>
                    <div class="box">
                        <i class="bx bx-bar-chart-alt" style="background-color: rgb(0, 108, 104);"></i>
                        <div class="amount-balance">
                            <span>Deposit To Your Avaliable Balance:</span>
                            <h1 class="balance" style="color: rgb(0, 108, 104);">₦0.000</h1>
                        </div>
                        <p>Deposites</p>
                        <button><span></span>Deposit</button>
                    </div>
                    <div class="box">
                        <i class="bx bx-money-withdraw" style="background-color: rgb(0, 208, 104);"></i>
                        <div class="amount-balance">
                            <span>Withdraw From Your Avaliable Balance:</span>
                            <h1 class="balance" style="color: rgb(0, 208, 104);">₦0.000</h1>
                        </div>
                        <p>Withdrawals</p>
                        <button><span></span>Withdraw</button>
                    </div>
                    <div class="box">
                        <i class="bx bx-money-withdraw" style="background-color: rgb(0, 50, 200);"></i>
                        <div class="amount-balance">
                            <span>Make Transfers From Your Avaliable Balance:</span>
                            <h1 class="balance" style="color: rgb(0, 50, 200);">₦0.000</h1>
                        </div>
                        <p>Transfers</p>
                        <button><span></span>Transfer</button>
                    </div>
                </div>
                <div class="deposit-container tab__item" content id="deposit-content">
                    <div class="container">
                        <form id="form" class="form">
                            <h2>Deposit</h2>
                            <div class="form-control">
                                <label for="depositInput">Deposit</label>
                                <input type="number" id="depositInput" class="login-username"
                                    placeholder="Amount to deposit">
                                <small>Error message</small>
                            </div>

                            <button type="submit" id="depositButton">Deposit</button>
                        </form>
                    </div>
                </div>
                <div class="withdraw-container tab__item" content id="withdraw-content">
                    <div class="container">
                        <form id="form" class="form">
                            <h2>Withdraw</h2>
                            <div class="form-control">
                                <label for="withdrawInput">Withdraw</label>
                                <input type="number" id="withdrawInput" placeholder="Amount to withdraw">
                                <small>Error message</small>
                            </div>

                            <div class="form-control">
                                <label for="pinInput">Pin</label>
                                <input type="password" id="pinInput" placeholder="Input Pin">
                                <small>Error message</small>
                            </div>

                            <button>Withdraw</button>
                        </form>
                    </div>
                </div>
                <div class="transfer-container tab__item" content id="transfer-content">
                    <div class="container">
                        <form id="form" class="form">
                            <h2>Transfer</h2>
                            <div class="form-control">
                                <label for="transferInput">Withdraw</label>
                                <input type="number" id="transferInput" placeholder="Amount to transfer">
                                <small>Error message</small>
                            </div>

                            <div class="form-control">
                                <label for="pinTransferInput">Pin</label>
                                <input type="password" id="pinTransferInput" placeholder="Input Pin">
                                <small>Error message</small>
                            </div>

                            <div class="form-control">
                                <label for="accountNum">Account Number</label>
                                <input type="number" id="accountNum" placeholder="Enter the Account Number">
                                <small>Error message</small>
                            </div>

                            <div class="form-control">
                                <label for="bank">Bank</label>
                                <input type="text" id="bank" placeholder="Enter the Bank Name">
                                <small>Error message</small>
                            </div>

                            <div class="form-control">
                                <label for="accountName">Account Name</label>
                                <input type="text" id="accountName" placeholder="Enter the Bank Name">
                                <small>Error message</small>
                            </div>

                            <button type="button" id="transferButton">Transfer</button>
                        </form>
                    </div>
                </div>
            </div>


        </div>

        <div id="pinModal" class="modal">
            <div class="modal-content">
                <label for="pinModalInput">Enter PIN:</label>
                <input type="password" id="pinModalInput">
                <button id="pinModalSubmit">Submit</button>
            </div>
        </div>
    </div>

    <script>
        const tabs = document.querySelectorAll('[data-target]');
        const tabContents = document.querySelectorAll('.tab__item');

        const depositButton = document.querySelector('#dashmain .box:nth-child(2) button');
        const withdrawButton = document.querySelector('#dashmain .box:nth-child(3) button');
        const transferButton = document.querySelector('#dashmain .box:nth-child(4) button');

        // Function to update active tab and tab content
        function updateActiveTab(tabId) {
            tabContents.forEach((tabContent) => {
                tabContent.classList.remove('active');
            });

            tabs.forEach((tab) => {
                tab.classList.remove('active');
            });

            const targetTab = document.querySelector(`[data-target="#${tabId}"]`);
            const targetContent = document.getElementById(tabId);

            targetTab.classList.add('active');
            targetContent.classList.add('active');
        }

        // Event listeners for buttons
        depositButton.addEventListener('click', () => {
            updateActiveTab('deposit-content');
        });

        withdrawButton.addEventListener('click', () => {
            updateActiveTab('withdraw-content');
        });

        transferButton.addEventListener('click', () => {
            updateActiveTab('transfer-content');
        });

        // Event listener for tabs
        tabs.forEach((tab) => {
            tab.addEventListener('click', () => {
                const target = document.querySelector(tab.dataset.target);

                updateActiveTab(target.id);
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const depositButton = document.getElementById("depositButton");
            const withdrawButton = document.querySelector("#withdraw-content button");
            const transferButton = document.getElementById("transferButton");

            // Use querySelectorAll to get all elements with class "balance"
            const balanceElements = document.querySelectorAll(".balance");

            const user = document.getElementById("user");
            const showBalanceButton = document.getElementById("showBalanceButton");

            // Retrieve values from localStorage
            var storedPin = localStorage.getItem('pin');
            var storedUsername = localStorage.getItem('username');
            var storedBalance = parseFloat(localStorage.getItem('balance')) || 0;

            // Update user and balance display
            user.textContent = storedUsername;
            balanceElements.forEach((element) => {
                element.setAttribute("data-amount", storedBalance);
            });
            updateBalanceDisplay();

            // Add event listeners to buttons
            depositButton.addEventListener('click', function (e) {
                e.preventDefault();
                deposit();
            });

            withdrawButton.addEventListener('click', function (e) {
                e.preventDefault();
                withdraw(storedPin);
            });

            transferButton.addEventListener('click', function (e) {
                e.preventDefault();
                transfer(storedPin);
            });

            showBalanceButton.addEventListener('click', function () {
                showBalance(storedPin);
            });

            function deposit() {
                const amountInput = document.getElementById("depositInput");
                const amount = parseFloat(amountInput.value);

                if (!isNaN(amount)) {
                    balanceElements.forEach((balanceElement) => {
                        let balance = parseFloat(balanceElement.getAttribute("data-amount") || 0);
                        balance += amount;
                        balanceElement.setAttribute("data-amount", balance);
                        updateBalanceDisplay();
                        // Update localStorage
                        localStorage.setItem('balance', balance);
                    });
                } else {
                    alert("Invalid amount!");
                }

                amountInput.value = "";


            }
            function withdraw(pin) {
                const amountInput = document.getElementById("withdrawInput");
                const amount = parseFloat(amountInput.value);
                const pinInput = document.getElementById("pinInput");

                if (!isNaN(amount)) {
                    const balanceElement = balanceElements[0]; // Use the first balance element

                    let balance = parseFloat(balanceElement.getAttribute("data-amount") || 0);
                    const enteredPin = parseFloat(pinInput.value);

                    if (enteredPin === parseInt(pin)) {
                        if (balance >= amount) {
                            balance -= amount;
                            // Update localStorage
                            localStorage.setItem('balance', balance);
                        } else {
                            alert("Insufficient funds!");
                            return;
                        }
                    } else if (enteredPin > 0 && enteredPin !== pin) {
                        alert("Incorrect pin");
                        return;
                    } else {
                        alert("Input your pin");
                        return;
                    }

                    balanceElement.setAttribute("data-amount", balance);
                    updateBalanceDisplay();
                } else {
                    alert("Invalid amount!");
                }

                amountInput.value = "";
                pinInput.value = "";
            }
            function transfer(pin) {
                const amountInput = document.getElementById("transferInput");
                const pinInput = document.getElementById("pinTransferInput");
                const accountNameElement = document.getElementById("accountName");
                const accountNumElement = document.getElementById("accountNum");
                const bankElement = document.getElementById("bank");

                const amount = parseFloat(amountInput.value);

                const accountName = accountNameElement.value.trim();
                const accountNum = accountNumElement.value.trim();
                const bank = bankElement.value.trim();

                if (accountName.length < 3 || accountNum.length < 3 || bank.length < 3) {
                    alert("Account name, account number, and bank must be at least 3 characters long.");
                    return;
                }

                if (!isNaN(amount)) {
                    const balanceElement = balanceElements[0]; // Use the first balance element

                    let balance = parseFloat(balanceElement.getAttribute("data-amount") || 0);
                    const enteredPin = parseFloat(pinInput.value);

                    if (enteredPin === parseInt(pin)) {
                        if (balance >= amount) {
                            balance -= amount;
                            // Update localStorage
                            localStorage.setItem('balance', balance);
                            setTimeout(() => {
                                alert(`You have successfully transferred ₦${amount} to ${accountName}, ${bank} bank`);
                            }, 100);
                        } else {
                            alert("Insufficient funds!");
                            return;
                        }
                    } else if (enteredPin > 0 && enteredPin !== pin) {
                        alert("Incorrect pin");
                        return;
                    } else {
                        alert("Input your pin");
                        return;
                    }

                    balanceElement.setAttribute("data-amount", balance);
                    updateBalanceDisplay();
                } else {
                    alert("Invalid amount!");
                }

                amountInput.value = "";
                pinInput.value = "";
            }

            function showBalance(pin) {
                const modal = document.getElementById("pinModal");
                const pinInput = document.getElementById("pinModalInput");
                const pinModalSubmit = document.getElementById("pinModalSubmit");

                const balanceElement = balanceElements[0]; // Use the first balance element

                if (balanceElement.classList.contains("hide")) {
                    modal.style.display = "flex";
                    pinModalSubmit.addEventListener("click", function () {
                        const enteredPin = pinInput.value;
                        if (enteredPin == parseInt(pin)) {
                            modal.style.display = "none";
                            balanceElement.classList.toggle("hide");
                            updateBalanceDisplay();
                            pinInput.value = "";
                        } else if (enteredPin != parseInt(pin)) {
                            modal.style.display = "none";
                            errorMessage.textContent = "Invalid Pin";
                        } else {
                            modal.style.display = "none";
                        }
                    });
                } else {
                    balanceElement.classList.toggle("hide");
                    updateBalanceDisplay();
                }

                errorMessage.textContent = "";
            }


            function updateBalanceDisplay() {
                const balance = parseFloat(balanceElements[0].getAttribute("data-amount") || 0);
                balanceElements.forEach((element) => {
                    if (!element.classList.contains("hide")) {
                        element.textContent = `₦${balance.toFixed(2)}`;
                        showBalanceButton.textContent = "Hide Balance";
                    } else {
                        element.textContent = "*******";
                        showBalanceButton.textContent = "Show Balance";
                    }
                });
                showBalanceButton.textContent = balanceElements[0].classList.contains("hide") ? "Show Balance" : "Hide Balance";
            }

        });
    </script>

</body>

</html>